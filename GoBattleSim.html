<script type="text/javascript" src="GoBattleSimLib.js"></script>
<script type="text/javascript" src="UI_1_general.js"></script>
<script type="text/javascript" src="UI_2_dom.js"></script>
<script type="text/javascript" src="UI_3_parser.js"></script>
<script type="text/javascript" src="UI_4_dom2.js"></script>
<script type="text/javascript" src="Populate_local.js"></script>


<script src="https://code.jquery.com/jquery-2.2.4.js"  integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/jquery-ui-git.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/ju/dt-1.10.16/r-2.2.1/sc-1.4.4/datatables.min.js"></script>

<link href="https://code.jquery.com/ui/jquery-ui-git.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/scroller/1.4.4/css/scroller.dataTables.min.css" rel="stylesheet">
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">

<style>
	table {
		width: 100%;
		margin-bottom: 0px;
	}
	div#ui-attackerinputbody h4 {
		background: white;
		padding: 8px;
		margin: 10px 0px 0px 0px;
		border: 1px solid #eceef3;
		border-radius: 2px;
	}
	th, td {
		vertical-align: middle;
		text-align: center;
		line-height: normal;
	}
	div#DefenderInput td,	
	div#AttackerInput td {
	    border: none;
	    padding: 5px 0px;
	}
	input, select {
		width: 100%;
        margin-bottom:0px !important;
	}
	
	.input-with-icon{
		padding-left: 40px !important;
		background-repeat: no-repeat;
		text-align: start;
	}
	.species-input-with-icon{
		background-size: 30px 30px;
		background-position: 5px;
	}
	.move-input-with-icon{
		background-size: 20px 20px;
		background-position: 10px;
	}
	
	button {
		width: 100%;
	}
	.ui-controlgroup-item {
		margin-top: 5px;
		margin-bottom: 5px;
	}
	
	.ui-button, .ui-button:focus{
		color: white;
		background-color: #3076b2;
	}
	.ui-button:hover, .ui-button:hover:focus{
		background-color: #366ea2;
	}
	

	.player_button, .player_button:focus {
		vertical-align: middle;
		height: 31.6px;
		color: #3076b2 !important;
		background-color: white;
		border: 1px solid #3076b2;
		padding: 0px 0px;
	}
	.player_button:hover, .player_button:hover:focus{
		color: #fff !important;
		background-color: #366ea2;
	}
	
	.section-node-head{
		height: 30px;
		padding-bottom: 3px;
		text-align: center;
	}
	.section-node-title{
		float: left;
		display: inline-block;
		width: 25%;
		text-align: left;
	}
	
	.section-buttons-panel{
		float: right;
		width: 25%;
		text-align: right;
	}
	.button-icon, .button-icon:focus{
		background-color: transparent;
		margin: 4px;
		cursor:pointer;
		height: 30px;
		width: 30px;
	}
	
	.ui-checkboxradio-label{
		color: white;
	}
	div#ui-mastersummarytable_filter {
	    float: none;
	}
	.dataTables_wrapper .dataTables_filter input {
	    margin: 5px 0px 0px 0px;
	}

	div#ui-mastersummarytable_filter {
	    float: none;
	    padding: 5px 5px 0px 5px;
	}
	table.dataTable thead .sorting {
	    background-image: none !important;
	}
	.dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter, .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_processing, .dataTables_wrapper .dataTables_paginate {
	    color: #585858;
	}
	.fg-toolbar.ui-toolbar.ui-widget-header.ui-helper-clearfix.ui-corner-bl.ui-corner-br {
	    padding: 0px 0px 10px 8px;
	}
	div#feedback_buttons {
		margin-bottom: 15px;
	}
	div#feedback_message {
	    margin-bottom: 10px;
	}
	div#ui-mastersummarytable_filter label {
		text-align: left;
	}
	
	img{
		max-width: 100%;
		max-height: 100%;
		vertical-align: middle !important;
	}
	.apitem-pokemon-icon {
		display:inline-block;
		align: center;
		vertical-align: middle;
		height: 30px !important;	
	}
	.apitem-move-icon {
		display:inline-block;
		align: center;
		vertical-align: middle !important;
		height: 20px !important;
	}
	.apitem-label{
		padding-left: 5px;
		vertical-align: middle !important;
		display:inline-block;
	}
	
	.section-body, div#ui-defenderinputbody > div{
		background: #f1f1f1;
		padding: 5px 8px;
		border-radius: 3px;
		margin: 10px 0px;
		border: 1px solid #ddd;
	}
	.section-player-node{
	}
	.section-party-node{
	}
	.section-pokemon-node{
	}
	
	.ui-autocomplete {
		max-height: 300px;
		overflow-y: auto;
		overflow-x: hidden;
		padding-right: 20px;
	}
	
	.ui-dialog-buttonset {
		width: 100%;
	}


</style>



<div id='menu'>
	<table style="position: relative; height: 40px"><colgroup><col width=25%><col width=25%><col width=25%><col width=25%></colgroup>
		<tr>
			<td style='vertical-align: top'><button id='quickStartWizardOpener'>
			<i class="fa fa-bolt" aria-hidden="true"></i> Quick Start</button></td>
			
			<td style='vertical-align: top; position: relative;'>
				<button id='subMenuOpener' onmouseover="//$('#subMenu').slideToggle('fast')" 
				onclick="$('#subMenu').slideToggle('fast')"><i class="fa fa-pencil" aria-hidden="true"></i> Customize</button>
				<div id='subMenu' style='position: absolute; width: 90%'>
					<button class='player_button' id='moveEditFormOpener'>Move</button>
					<button class='player_button' id='pokemonEditFormOpener'>Species</button>
					<button class='player_button' id='parameterEditFormOpener'>Other Paramaters</button>
				</div>

			</td>
			
			<td style='vertical-align: top'><button id='userEditFormOpener'><i class="fa fa-user" aria-hidden="true"></i> User/Box</button></td>
			
			<td style='vertical-align: top'><button onclick="window.open('https://pokemongo.gamepress.gg/comprehensive-guide-gobattlesim', '_blank')">
				<i class="fa fa-book" aria-hidden="true"></i> Guide</button></td>
		</tr>
	</table>
</div>

<div id="AttackerInput">
	<div id="ui-attackerinputhead">
		<h2>Attacker Information</h2>
		<button id='ui-addplayerbutton' class='player_button' onclick="addPlayerNode()"><i class="fa fa-user-plus" aria-hidden="true"></i> Add Player</button>
	</div>
	
	<div id="ui-attackerinputbody">
	</div>
	
	<div id="ui-attackerinputtail">
	</div>
</div>



<div id="DefenderInput">
	<div id="ui-defenderinputhead">
		<h2>Defender Information</h2>
	</div>
	
	<div id="ui-defenderinputbody">
	</div>
	
	<div id="ui-defenderinputtail">
	</div>
</div>


<h2>General Settings</h2>
<div id="GeneralSettings">
	<table>
	<col width=20%><col width=20%><col width=20%><col width=20%><col width=20%>
	<tr>
		<th>Mode</th>
		<td><select id="battleMode"  onchange="updateDefenderNode(this.value)">
				<option value="gym">Gym</option>
				<option value="raid" selected="selected">Raid</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Immortal Defender</th>
		<td><select id="immortalDefender">
				<option value="0">No</option>
				<option value="1">Yes</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Weather</th>
		<td>
			<select id="weather">
				<option value="EXTREME">Extreme</option>
				<option value="SUNNY_CLEAR">Sunny/Clear</option>
				<option value="RAIN">Rain</option>
				<option value="PARTLY_CLOUDY">Party Cloudy</option>
				<option value="CLOUDY">Cloudy</option>
				<option value="WINDY">Windy</option>
				<option value="SNOW">Snow</option>
				<option value="FOG">Fog</option>
				<option value="*">*All</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Dodge Bug</th>
		<td>
			<select id="dodgeBug">
				<option value="0">Absent</option>
				<option value="1">Present</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Repeat</th>
		<td>
			<input id="simPerConfig" type="number" min="1">
		</td>
	</tr>
	<tr>
		<th>Report Type</th>
		<td>
			<select id="reportType">
				<option value="enum">Enumerate</option>
				<option value="avrg">Average</option>
			</select>
		</td>
	</tr>
	</table>
<p></p>
</div>

<button onclick="main()" id="GoButton">Go</button>


<h2>Feedback</h2>
<div id="feedback_message">
</div>

<div id="feedback_buttons"></div>
<div id="feedback_table1"></div>
<div id="feedback_table2"></div>



<div id='moveEditForm' title="Add/Edit Move">
	<table>
		<tr>
			<th>Move Category</th> 
			<td><select id='moveEditForm-moveType'>
				<option value='f'>Fast</option>
				<option value='c'>Charged</option>
			</select></td>
		</tr>
		<tr>
			<th>Move Name</th> 
			<td><input type='text' id='moveEditForm-name' class='input-with-icon move-input-with-icon'></td>
		</tr>
		<tr>
			<th>Move Typing</th> 
			<td><select id='moveEditForm-pokeType'></select></td>
		</tr>
		<tr>
			<th>Power</th> 
			<td><input type='number' id='moveEditForm-power'></td>
		</tr>
		<tr>
			<th>EnergyDelta</th> 
			<td><input type='number' id='moveEditForm-energyDelta'></td>
		</tr>
		<tr>
			<th>Duration (in seconds)</th> 
			<td><input type='number' id='moveEditForm-duration'></td>
		</tr>
		<tr>
			<th>Damage Window (in seconds)</th> 
			<td><input type='number' id='moveEditForm-dws'></td>
		</tr>
	</table>
	<br>
	
	<table> 
		<colgroup><col width='50%'><col width='50%'></colgroup>
		<tr>
			<td><button onclick='moveEditFormSubmit()' id='moveEditForm-submit'><i class="fa fa-check" aria-hidden="true"></i> Save</button></td>
			<td><button onclick='moveEditFormReset()' id='moveEditForm-reset'><i class="fa fa-refresh" aria-hidden="true"></i> Reset</button></td>
		</tr>
	</table>
	
	<div id='moveEditForm-feedback'>
	</div>
</div>


<div id='pokemonEditForm' title="Add/Edit Pokemon">
	<table>
		<tr>
			<th>Pokemon Name</th> 
			<td><input type='text' id='pokemonEditForm-name' class='input-with-icon species-input-with-icon'></td>
		</tr>
		<tr>
			<th>Pokemon Typing 1</th> 
			<td><select id='pokemonEditForm-pokeType1'></select></td>
		</tr>
		<tr>
			<th>Pokemon Typing 2</th> 
			<td><select id='pokemonEditForm-pokeType2'></select></td>
		</tr>
		<tr>
			<th>Base Attack</th> 
			<td><input type='number' id='pokemonEditForm-baseAtk'></td>
		</tr>
		<tr>
			<th>Base Defense</th> 
			<td><input type='number' id='pokemonEditForm-baseDef'></td>
		</tr>
		<tr>
			<th>Base Stamina</th> 
			<td><input type='number' id='pokemonEditForm-baseStm'></td>
		</tr>
		<tr>
			<th>Fast Move Pool</th> 
			<td><input type='text' id='pokemonEditForm-fmoves'></td>
		</tr>
		<tr>
			<th>Charged Move Pool</th> 
			<td><input type='text' id='pokemonEditForm-cmoves'></td>
		</tr>

	</table>
	<br>
	
	
	<table> 
		<colgroup><col width='50%'><col width='50%'></colgroup>
		<tr>
			<td><button onclick='pokemonEditFormSubmit()' id='pokemonEditForm-submit'><i class="fa fa-check" aria-hidden="true"></i> Save</button></td>
			<td><button onclick='pokemonEditFormReset()' id='pokemonEditForm-reset'><i class="fa fa-refresh" aria-hidden="true"></i> Reset</button></td>
		</tr>
	</table>
	
	
	
	<div id='pokemonEditForm-feedback'>
	</div>
</div>


<div id='userEditForm' title="Add/Edit User">
	<h4>List of Users</h4>
	<table id='userEditForm-userTable'>
		<thead>
			<tr> <th>Player No.</th> <th>UserID</th> <th>PokeBox Length</th> <th>Action</th> </tr>
		</thead>
		<tbody>
		
		</tbody>
	</table>
	
	<br>
	<input type='text' id='userEditForm-userID-1' placeholder='userID To Add/Remove'></input>
	<table><colgroup><col width=50%><col width=50%></colgroup>
		<tr>
			<td><button onclick='userEditFormAddUser()'><i class="fa fa-user-plus" aria-hidden="true"></i> Add User</button></td>
			<td><button onclick='userEditFormRemoveUser()'><i class="fa fa-user-times" aria-hidden="true"></i> Remove User</button></td>
		</tr>
	</table>
	
	<div id='userEditForm-feedback'>
	</div>
</div>


<div id='boxEditForm' title="Manage Pokebox">
	<h4 id='boxEditForm-title'>User: </h4>
	<table id='boxEditForm-pokemonTable'>
		<thead>
			<tr>
				<th>#</th>
				<th><img src='https://pokemongo.gamepress.gg/assets/img/sprites/000MS.png'></img></th>
				<th>Type1</th>
				<th>Type2</th>
				<th>Nickname</th>
				<th>CP</th>
				<th>Level</th>
				<th>HP IV</th>
				<th>Atk IV</th>
				<th>Def IV</th>
				<th>Fast Move</th>
				<th>Charged Move</th>
			</tr>
		</thead>
		<tbody>
		
		</tbody>
	</table>
	<br>
	<button onclick='boxEditFormSubmit()' id='boxEditForm-submit'><i class="fa fa-check" aria-hidden="true"></i> Save</button>
	
	<div id='boxEditForm-feedback'>
	</div>
</div>


<div id='parameterEditForm' title='Edit Paramaters'>
	<table id='parameterEditForm-Table'>
		<thead>
			<tr>
				<th>Paramater</th>
				<th>Value</th>
			</tr>
		</thead>
		<tbody>

		</tbody>
	</table>
	<br>
	<table> 
		<colgroup><col width='50%'><col width='50%'></colgroup>
		<tr>
			<td><button onclick='parameterEditFormSubmit()' id='parameterEditForm-submit'><i class="fa fa-check" aria-hidden="true"></i> Save</button></td>
			<td><button onclick='parameterEditFormReset()' id='parameterEditForm-reset'><i class="fa fa-refresh" aria-hidden="true"></i> Reset</button></td>
		</tr>
	</table>
	
	<div id='parameterEditForm-feedback'>
	</div>
</div>


<div id="quickStartWizard" title="Welcome to GoBattleSim - Quick Start">
	<div id='quickStartWizard-tabs'>

		<div id='tabs-1' style='height: 100px'>
			<h4>1. Solo or Group fight?</h4>
			<table>
				<colgroup><col width='50%'><col width='50%'></colgroup>
				<tr>
					<td><input type='number' id='quickStartWizard-numPlayer' min='1' placeholder='number of players'></input></td>
					<td><select id='quickStartWizard-pokemonSource' style='color: white'>
						<option value='$'>From My Box</option>
						<option value='30'>Generic Level 30</option>
						<option value='40'>Generic Level 40</option>
					</select></td>
				</tr>
			</table>
			
			<i>You can add other GamePressers' PokeBox <b><a onclick='udpateUserTable();$("#userEditForm").dialog("open");' style="cursor: pointer;">here</a></b></i>
		</div>
		
		
		<div id='tabs-2' style='width: 100%; height: 220px'>
			<h4>2. Which Raid Boss?</h4>
			
			<div id='quickStartWizard-raidbosstags' style='width:100%; height:60px'>
				<input type="radio" id="bossTag1" name='boss-tag' onclick='populateQuickStartWizardBossList("current")' checked>
				<label for="bossTag1">Current</label>
				<input type="radio" id="bossTag2" name='boss-tag' onclick='populateQuickStartWizardBossList("legacy")'>
				<label for="bossTag2">Legacy</label>
				<input type="radio" id="bossTag3" name='boss-tag' onclick='populateQuickStartWizardBossList("future")'>
				<label for="bossTag3">Future</label>
				<input type="radio" id="bossTag4" name='boss-tag' onclick='populateQuickStartWizardBossList("special")'>
				<label for="bossTag4">Special</label>
			</div>
			
			<div style='width: 100%; height: 100px'>
				<span style='width:50%; float:left; display: inline-block'>
					<ul style='width:60%; float:top' id="quickStartWizard-raidbosslist" >
					</ul>
				</span>
				<span style='width:50%; float:right; display: inline-block'>
					<img id='ui-species_QSW-boss' style='width:160px; height:160px' name='latios' index='380' raid_tier='5'
						src='https://pokemongo.gamepress.gg/sites/pokemongo/files/2017-08/381_0.png'></img>
				</span>

			</div>
			
			
		</div>
		
		<div id='tabs-3' style='width: 100%; height: 100px'>
			<h4>3. Which Move set?</h4>
			
			<div id='quickStartWizard-moves'>
				<input type="radio" id="quickStartWizard-moves-enum" name='qsW-moves' value="enum" onclick='quickStartWizard_moves(this.value)' checked>
				<label for="quickStartWizard-moves-enum">List All</label>
				<input type="radio" id="quickStartWizard-moves-avrg" name='qsW-moves' value="avrg" onclick='quickStartWizard_moves(this.value)'>
				<label for="quickStartWizard-moves-avrg">Average All</label>
				<input type="radio" id="quickStartWizard-moves-spec" name='qsW-moves' value="spec" onclick='quickStartWizard_moves(this.value)'>
				<label for="quickStartWizard-moves-spec">Specify One</label>
			</div>
			
			<table id='quickStartWizard-movesTable'>
			<colgroup><col width='50%'><col width='50%'></colgroup>
			<tr>
				<td><input id='fmove_QSW-boss' placeholder='Fast Move' class='input-with-icon move-input-with-icon'></input></td>
				<td><input id='cmove_QSW-boss' placeholder='Charged Move' class='input-with-icon move-input-with-icon'></input></td>
			</tr>
			</table>
		</div>
		
		<div id='tabs-4' style='width: 100%; height: 100px'>
			<h4>4. Sort the result by?</h4>
			
			<div id='quickStartWizard-sortBy'>
				<input type="radio" id="quickStartWizard-sortBy-dps" name='qsW_sort' value="dps" onclick='qsW_sort="dps";' checked >
				<label for="quickStartWizard-sortBy-dps">DPS</label>
				<input type="radio" id="quickStartWizard-sortBy-tdo" name='qsW_sort' value="tdo" onclick='qsW_sort="tdo";'>
				<label for="quickStartWizard-sortBy-tdo">TDO</label>
			</div>
		</div>
		
	</div>
</div>



<div id='tempDialog' title='GoBattleSim'>
Simulating...
</div>




<script>

const HSL_COLORS = [
	['hsl(209, 100%, 90%)','hsl(209, 100%, 80%)','hsl(209, 100%, 70%)'],
	['hsl(0, 100%, 90%)','hsl(0, 100%, 80%)','hsl(0, 100%, 70%)'],
	['hsl(48, 100%, 90%)','hsl(48, 100%, 70%)','hsl(48, 100%, 50%)'],
	['hsl(120, 60%, 90%)','hsl(120, 60%, 70%)','hsl(120, 60%, 50%)']
];

const DEFAULT_SUMMARY_TABLE_METRICS = {battle_result:'Outcome', duration:'Time', tdo_percent:'TDO%', dps:'DPS', total_deaths:'#Death'};

// For quick start wizard configurations
const DEFAULT_ATTACKER_INPUT_MIN = {
	copies: 6,
	species: "*rating3~",
	level: 40,
	atkiv: 15,
	defiv: 15,
	stmiv: 15,
	fmove: "*",
	cmove: "*",
	dodge: 0
};

const DEFAULT_GENERAL_SETTING_INPUT_MIN = {
	battleMode: "raid", 
	weather: "EXTREME",
	immortalDefender: 0,
	dodgeBug: 0,
	simPerConfig : 1,
	reportType : "enum"
};


const QUICK_START_WIZARD_CONFIG_1 = {
	generalSettings : DEFAULT_GENERAL_SETTING_INPUT_MIN,
	atkrSettings : [{
		party_list : [{
			revive_strategy : true,
			pokemon_list: [DEFAULT_ATTACKER_INPUT_MIN]
		}]
	}],
	dfdrSettings : {
		species: "machamp",
		fmove: "*current",
		cmove: "*current",
		raid_tier: 3
	}
};

const QUICK_START_WIZARD_CLONE_PLAYER = {
	party_list : [{
		revive_strategy : true,
		pokemon_list: [{
			copies: 6,
			species: "=1-1-1",
			level: "=1-1-1",
			atkiv: "=1-1-1",
			defiv: "=1-1-1",
			stmiv: "=1-1-1",
			fmove: "=1-1-1",
			cmove: "=1-1-1",
			dodge: 0
		}]
	}]
};

var currentJobSize = 0;
var maxJobSize = 0;
var simResults = [];
var atkrCopyPasteClipboard = null;
var MasterSummaryTableMetrics = JSON.parse(JSON.stringify(DEFAULT_SUMMARY_TABLE_METRICS));
var qsW_sort = 'dps';



/* Initialize Modules*/
$("#savePartyDialog").dialog({
	autoOpen: false,
	modal: true
});

$("#removePartyDialog").dialog({
	autoOpen: false,
	modal: true
});


// Sub Menu for Add/Edit functions
$( '#subMenu' ).hide();
$( '#subMenu' ).menu();


// Move Edit Form
$( "#moveEditForm" ).dialog({ 
	autoOpen: false,
	width: 600
});
$( "#moveEditFormOpener" ).click(function() {
	$('#subMenu').hide();
	$( "#moveEditForm" ).dialog( "open" );
});
autocompleteMoveEditForm();
$( "#moveEditFormOpener" ).on('dialogclose', function(event) {
	send_feedback('', false, 'moveEditForm-feedback');
});

// Species Edit Form
$( "#pokemonEditForm" ).dialog({ 
	autoOpen: false,
	width: 600
});
$( "#pokemonEditFormOpener" ).click(function() {
	$('#subMenu').hide();
	$( "#pokemonEditForm" ).dialog( "open" );
});
autocompletePokemonEditForm();
$( "#pokemonEditForm" ).on('dialogclose', function(event) {
	send_feedback('', false, 'pokemonEditForm-feedback');
});

var moveEditFormPokeTypeSelect = document.getElementById('moveEditForm-pokeType');
var pokemonEditFormPokeType1Select = document.getElementById('pokemonEditForm-pokeType1');
var pokemonEditFormPokeType2Select = document.getElementById('pokemonEditForm-pokeType2');
for (var type in POKEMON_TYPE_ADVANTAGES){
	moveEditFormPokeTypeSelect.appendChild(createElement('option', toTitleCase(type), {value : type}));
	pokemonEditFormPokeType1Select.appendChild(createElement('option', toTitleCase(type), {value : type}));
	pokemonEditFormPokeType2Select.appendChild(createElement('option', toTitleCase(type), {value : type}));
}
pokemonEditFormPokeType1Select.appendChild(createElement('option', 'None', {value : 'none'}));
pokemonEditFormPokeType2Select.appendChild(createElement('option', 'None', {value : 'none'}));


// Other Parameters Edit Form
$( "#parameterEditForm" ).dialog({ 
	autoOpen: false,
	width: 600,
	maxHeight: 700
});
$( "#parameterEditFormOpener" ).click(function() {
	$('#subMenu').hide();
	$( "#parameterEditForm" ).dialog( "open" );
});
$( "#parameterEditForm" ).on('dialogclose', function(event) {
	send_feedback('', false, 'parameterEditForm-feedback');
});

var parameterTable = document.getElementById('parameterEditForm-Table');
editableParameters.forEach(function(attr){
	var row = createRow([
		attr,
		"<input type='number' id='parameterEditForm-" + attr + "'></input>"
	],'td');
	row.children[1].children[0].value = window[attr];
	parameterTable.children[1].appendChild(row);
});


// User Edit Form
$( "#userEditForm" ).dialog({ 
	autoOpen: false,
	width: 600
});
$( "#userEditFormOpener" ).click(function() {
	udpateUserTable();
	$( "#userEditForm" ).dialog( "open" );
});
$( "#userEditForm" ).on('dialogclose', function(event) {
	send_feedback('', false, 'userEditForm-feedback');
});


$( "#boxEditForm" ).dialog({ 
	autoOpen: false,
	width: 600
});
$( '#boxEditForm-pokemonTable' ).DataTable({
	scrollX: true,
	scrollY: '50vh',
	scroller: true,
	searching: false
});





// Populate valid IV and Level values
for (var i = 0; i < 16; i++){
	IV_VALUES.push({value: i});
}
for (var i = 1; i <= 40; i += 0.5){
	LEVEL_VALUES.push({value: i});
}


// Quick Start Wizard
$( '#quickStartWizard-pokemonSource' ).selectmenu({appendTo: '#quickStartWizard'});

$( '#quickStartWizard-raidbosstags' ).controlgroup();

$( '#quickStartWizard-moves' ).controlgroup();

$( '#quickStartWizard-sortBy' ).controlgroup();

$('#quickStartWizard-movesTable').hide();
function quickStartWizard_moves(value){
	if (value == 'spec'){
		document.getElementById('tabs-3').setAttribute('style', 'width: 100%; height: 200px');
		$('#quickStartWizard-movesTable').show();
	}else{
		document.getElementById('tabs-3').setAttribute('style', 'width: 100%; height: 100px');
		$('#quickStartWizard-movesTable').hide();
		if (value == 'avrg'){
			document.getElementById('fmove_QSW-boss').value = '?current';
			document.getElementById('cmove_QSW-boss').value = '?current';
		}else{
			document.getElementById('fmove_QSW-boss').value = '*current';
			document.getElementById('cmove_QSW-boss').value = '*current';
		}
	}
}

$ ('#quickStartWizard-raidbosslist').menu();

autocompletePokemonNodeMoves(document.getElementById('fmove_QSW-boss'));
autocompletePokemonNodeMoves(document.getElementById('cmove_QSW-boss'));
$('#fmove_QSW-boss').autocomplete( "option", "appendTo", "#quickStartWizard" );
$('#cmove_QSW-boss').autocomplete( "option", "appendTo", "#quickStartWizard" );

$("#quickStartWizard").dialog({ 
	autoOpen: false,
	width: 600,
	height: 700,
	buttons: [{
		text: 'GO',
		style: 'width: 40%; float: left;',
		click: quickStartWizard_submit
		
	},{
		text: "Don't show Up Again",
		style: 'width: 40%; float: right;',
		click: quickStartWizard_dontshowup
	}]
});

$ ('#quickStartWizardOpener').click(function() {
	$( "#quickStartWizard" ).dialog( "open" );
});


// Final preparation
function handle_2(){
	if (typeof userID2 != 'underfined' && userID2){
		loadLatestPokeBox(userID2, function(){
			send_feedback("Imported user " + userID2, false, 'userEditForm-feedback');
			udpateUserTable();
		});
	}
	
	if (window.location.href.includes('?')){
		writeUserInput(parseConfigFromUrl(window.location.href.split('?')[1]));
		main({maxJobSize: 10000});
	}
	
	populateQuickStartWizardBossList('current');
	
	if (localStorage && !localStorage.QUICK_START_WIZARD_NO_SHOW && !window.location.href.includes('?'))
		$( "#quickStartWizard" ).dialog( "open" );
}


function main(args){
	var userInput = readUserInput();
	window.history.pushState('', "GoBattleSim", window.location.href.split('?')[0] + '?' + exportConfigToUrl(userInput));
	
	if (!(args && args.noDisplay)){
		$( '#tempDialog' ).dialog( 'open' );
		args = args || {};
		if (!args.noWait){
			args.noWait = true;
			setTimeout(function(){main(args);}, 100);
			return;
		}
	}
	initMasterSummaryTableMetrics();

	if (args && args.maxJobSize){
		maxJobSize = args.maxJobSize;
	}
	
	date = new Date();
	console.log(date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds() + '.' + date.getMilliseconds()  + ": Simulations started");
	
	var tempResults = iterBranchHandler(userInput);
	tempResults.forEach(function(sim){
		if (sim)
			simResults.push(sim);
	});
	
	date = new Date();
	console.log(date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds() + '.' + date.getMilliseconds()  + ": Simulations completed");
	
	if (args && args.sortBy){
		simResults.sort(function (a,b){
			return b.output.generalStat[args.sortBy] - a.output.generalStat[args.sortBy];
		});
	}
	
	$( '#tempDialog' ).dialog('close');
	if (!(args && args.noDisplay)){
		send_feedback(currentJobSize + " sims have been performed", true);
		displayMasterSummaryTable();
		setTimeout(function(){
			document.getElementById('ui-mastersummarytable').scrollIntoView({behavior: "smooth", block: "center", inline: "center"});
		}, 100);
	}
}


$('#tempDialog').dialog({autoOpen: false});
addPlayerNode();
document.getElementById("ui-defenderinputbody").innerHTML = "";
document.getElementById("ui-defenderinputbody").appendChild(createDefenderNode());
document.getElementById("simPerConfig").value = 1;

</script>