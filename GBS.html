
<script src="https://code.jquery.com/jquery-2.2.4.js"  integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/jquery-ui-git.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/ju/dt-1.10.16/r-2.2.1/sc-1.4.4/datatables.min.js"></script>

<script type="text/javascript" src="GBS_Core.js"></script>
<script type="text/javascript" src="GBS_UI_1_general.js"></script>
<script type="text/javascript" src="GBS_UI_2_dom.js"></script>
<script type="text/javascript" src="GBS_UI_3_parser.js"></script>
<script type="text/javascript" src="GBS_UI_4_dom2.js"></script>
<script type="text/javascript" src="GBS_Populate.js"></script>
<script type="text/javascript" src="GBS_Populate_extras.js"></script>
<script type="text/javascript" src="GBS_Populate_local.js"></script>

<link href="https://code.jquery.com/ui/jquery-ui-git.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/scroller/1.4.4/css/scroller.dataTables.min.css" rel="stylesheet">
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">

<style>
	table {
		width: 100%;
		margin-bottom: 0px;
	}
	div#ui-attackerinputbody h4 {
		background: white;
		padding: 8px;
		margin: 10px 0px 0px 0px;
		border: 1px solid #eceef3;
		border-radius: 2px;
	}
	th, td {
		vertical-align: middle;
		text-align: center;
		line-height: normal;
	}
	div#DefenderInput td,	
	div#AttackerInput td {
	    border: none;
	    padding: 5px 0px;
	}
	input, select {
		width: 100%;
        margin-bottom:0px !important;
	}
	
	.input-with-icon{
		padding-left: 40px !important;
		background-repeat: no-repeat;
		text-align: start;
	}
	.species-input-with-icon{
		background-size: 30px 30px;
		background-position: 5px;
	}
	.move-input-with-icon{
		background-size: 20px 20px;
		background-position: 10px;
	}
	
	button {
		width: 100%;
	}
	.ui-controlgroup-item {
		margin-top: 5px;
		margin-bottom: 5px;
	}
	
	.ui-button, .ui-button:focus{
		color: white;
		background-color: #3076b2;
	}
	.ui-button:hover, .ui-button:hover:focus{
		background-color: #366ea2;
	}
	

	.player_button, .player_button:focus {
		vertical-align: middle;
		height: 31.6px;
		color: #3076b2 !important;
		background-color: white;
		border: 1px solid #3076b2;
		padding: 0px 0px;
	}
	.player_button:hover, .player_button:hover:focus{
		color: #fff !important;
		background-color: #366ea2;
	}
	
	.section-node-head{
		height: 30px;
		padding-bottom: 3px;
		text-align: center;
	}
	.section-node-title{
		float: left;
		display: inline-block;
		width: 25%;
		text-align: left;
	}
	
	.section-buttons-panel{
		float: right;
		width: 25%;
		text-align: right;
	}
	.button-icon, .button-icon:focus{
		background-color: transparent;
		margin: 4px;
		cursor:pointer;
		height: 30px;
		width: 30px;
	}
	
	.ui-checkboxradio-label{
		color: white;
	}
	div#ui-mastersummarytable_filter {
	    float: none;
	}
	.dataTables_wrapper .dataTables_filter input {
	    margin: 5px 0px 0px 0px;
	}

	div#ui-mastersummarytable_filter {
	    float: none;
	    padding: 5px 5px 0px 5px;
	}
	table.dataTable thead .sorting {
	    background-image: none !important;
	}
	.dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter, .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_processing, .dataTables_wrapper .dataTables_paginate {
	    color: #585858;
	}
	.fg-toolbar.ui-toolbar.ui-widget-header.ui-helper-clearfix.ui-corner-bl.ui-corner-br {
	    padding: 0px 0px 10px 8px;
	}
	div#feedback_buttons {
		margin-bottom: 15px;
	}
	div#feedback_message {
	    margin-bottom: 10px;
	}
	div#ui-mastersummarytable_filter label {
		text-align: left;
	}
	
	img{
		max-width: 100%;
		max-height: 100%;
		vertical-align: middle !important;
	}
	.apitem-pokemon-icon {
		display:inline-block;
		align: center;
		vertical-align: middle;
		height: 30px !important;	
	}
	.apitem-move-icon {
		display:inline-block;
		align: center;
		vertical-align: middle !important;
		height: 20px !important;
	}
	.apitem-label{
		padding-left: 5px;
		vertical-align: middle !important;
		display:inline-block;
	}
	
	.section-body, div#ui-defenderinputbody > div{
		background: #f1f1f1;
		padding: 5px 8px;
		border-radius: 3px;
		margin: 10px 0px;
		border: 1px solid #ddd;
	}
	.section-player-node{
	}
	.section-party-node{
	}
	.section-pokemon-node{
	}
	
	.ui-autocomplete {
		max-height: 300px;
		overflow-y: auto;
		overflow-x: hidden;
		padding-right: 20px;
	}
	
	.ui-dialog-buttonset {
		width: 100%;
	}
	
	.sub-menu-container {
		vertical-align: top; 
		position: relative;
	}
	
	.sub-menu-opener {
	}
	
	.sub-menu {
		position: absolute;
		width: 90%;
	}


</style>



<div id='menu'>
	<table style="position: relative; height: 40px"><colgroup><col width=25%><col width=25%><col width=25%><col width=25%></colgroup>
		<tr>
			<td style='vertical-align: top'>
				<button id='userEditFormOpener'><i class="fa fa-user" aria-hidden="true"></i> User/Box</button>
			</td>
			
			<td class='sub-menu-container'>
				<button class='sub-menu-opener'><i class="fa fa-cog" aria-hidden="true"></i> Customize</button>
				<div class='sub-menu'>
					<button class='player_button' id='moveEditFormOpener'>Move</button>
					<button class='player_button' id='pokemonEditFormOpener'>Species</button>
					<button class='player_button' id='parameterEditFormOpener'>Battle Settings</button>
					<button class='player_button' id='modEditFormOpener'>Mods</button>
				</div>

			</td>
			
			<td class='sub-menu-container'>
				<button class='sub-menu-opener'><i class="fa fa-wrench" aria-hidden="true"></i> Tools</button>
				<div class='sub-menu'>
					<button class='player_button' id='breakpointCalculatorOpener'>Breakpoint Calc</button>
					<button class='player_button' id='MVLTableOpener'>MVL Table</button>
				</div>
			</td>
			
			<td class='sub-menu-container'>
				<button class='sub-menu-opener'><i class="fa fa-question" aria-hidden="true"></i> Help</button>
				<div class='sub-menu'>
					<button class='player_button' id='quickStartWizardOpener'>Quick Start</button>
					<button class='player_button' onclick="window.open('https://pokemongo.gamepress.gg/comprehensive-guide-gobattlesim', '_blank')">User Manual</button>
					<button class='player_button' onclick="window.open('https://pokemongo.gamepress.gg/gobattlesim-and-comprehensive-dps-spreadsheet-change-log', '_blank')">Change Log</button>
				</div>
			</td>
			
		</tr>
	</table>
</div>



<div id="AttackerInput">
	<div id="ui-attackerinputhead">
		<h2>Attacker Settings</h2>
		<button id='ui-addplayerbutton' class='player_button' onclick="addPlayerNode()"><i class="fa fa-user-plus" aria-hidden="true"></i> Add Player</button>
	</div>
	
	<div id="ui-attackerinputbody">
	</div>
	
	<div id="ui-attackerinputtail">
	</div>
</div>


<div id="DefenderInput">
	<div id="ui-defenderinputhead">
		<h2>Defender Settings</h2>
	</div>
	
	<div id="ui-defenderinputbody">
	</div>
	
	<div id="ui-defenderinputtail">
	</div>
</div>



<div id="GeneralSettings">
	<h2>General Settings</h2>
	<table>
	<col width=20%><col width=20%><col width=20%><col width=20%><col width=20%>
	<tr>
		<th>Mode</th>
		<td><select id="battleMode" onchange="updateDefenderNode(this.value)">
				<option value="gym">Gym</option>
				<option value="raid" selected="selected">Raid</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Immortal Defender</th>
		<td><select id="immortalDefender">
				<option value="0">No</option>
				<option value="1">Yes</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Weather</th>
		<td>
			<select id="weather">
			</select>
		</td>
	</tr>
	<tr>
		<th>Dodge Bug</th>
		<td>
			<select id="dodgeBug">
				<option value="0">Absent</option>
				<option value="1">Present</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Repeat</th>
		<td>
			<input id="simPerConfig" type="number" min="1">
		</td>
	</tr>
	<tr>
		<th>Aggregation</th>
		<td>
			<select id="aggregation">
				<option value="enum">Enumerate</option>
				<option value="avrg">Average</option>
			</select>
		</td>
	</tr>
	</table>

</div>

<button onclick="requestSimulation()" id="GoButton">Go</button>


<h2>Feedback</h2>
<div id="feedback_message">
</div>

<div id="feedback_buttons"></div>
<div id="feedback_table1"></div>
<div id="feedback_table2"></div>



<script>

const HSL_COLORS = [
	['hsl(209, 100%, 90%)','hsl(209, 100%, 80%)','hsl(209, 100%, 70%)'],
	['hsl(0, 100%, 90%)','hsl(0, 100%, 80%)','hsl(0, 100%, 70%)'],
	['hsl(48, 100%, 90%)','hsl(48, 100%, 70%)','hsl(48, 100%, 50%)'],
	['hsl(120, 60%, 90%)','hsl(120, 60%, 70%)','hsl(120, 60%, 50%)']
];

const DEFAULT_SUMMARY_TABLE_METRICS = {battle_result:'Outcome', duration:'Time', tdo_percent:'TDO%', dps:'DPS', total_deaths:'#Death'};

// For quick start wizard configurations
const DEFAULT_ATTACKER_INPUT_MIN = {
	copies: 6,
	name: "*rating3~",
	level: 40,
	atkiv: 15,
	defiv: 15,
	stmiv: 15,
	fmove: "*",
	cmove: "*",
	dodge: 0
};

const DEFAULT_GENERAL_SETTING_INPUT_MIN = {
	battleMode: "raid", 
	weather: "EXTREME",
	immortalDefender: 0,
	dodgeBug: 0,
	simPerConfig : 1,
	aggregation : "enum"
};


const QUICK_START_WIZARD_CONFIG_1 = {
	generalSettings : DEFAULT_GENERAL_SETTING_INPUT_MIN,
	atkrSettings : [{
		party_list : [{
			revive_strategy : true,
			pokemon_list: [DEFAULT_ATTACKER_INPUT_MIN]
		}]
	}],
	dfdrSettings : {
		species: "machamp",
		fmove: "*current",
		cmove: "*current",
		raid_tier: 3
	}
};

const QUICK_START_WIZARD_CLONE_PLAYER = {
	party_list : [{
		revive_strategy : true,
		pokemon_list: [{
			copies: 6,
			species: "=1-1-1",
			level: "=1-1-1",
			atkiv: "=1-1-1",
			defiv: "=1-1-1",
			stmiv: "=1-1-1",
			fmove: "=1-1-1",
			cmove: "=1-1-1",
			dodge: 0
		}]
	}]
};

var simResults = [];
var MasterSummaryTableMetrics = JSON.parse(JSON.stringify(DEFAULT_SUMMARY_TABLE_METRICS));
var qsW_sort = 'dps';
var currentJobSize = 0;


/* Initialize Modules*/
$("#removePartyDialog").dialog({
	autoOpen: false,
	modal: true
});

var gs_weather = document.getElementById('weather');
Data.WeatherSettings.forEach(function(weatherSetting){
	gs_weather.appendChild(createElement('option', weatherSetting.label, {value: weatherSetting.name}));
});


dropdownMenuInit();

moveEditFormInit();
pokemonEditFormInit();
parameterEditFormInit();
modEditFormInit();
userEditFormInit();
breakpointCalculatorInit();
MVLTableInit();
QuickStartWizardInit();

populateAll(applicationInit);

</script>